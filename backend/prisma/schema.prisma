generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id               String           @id @default(uuid())
  name             String
  email            String?          @unique
  phone            String?          @unique
  password         String
  role             UserRole         @default("JOB_SEEKER")
  bio              String?
  skills           Json?
  experience       String?
  education        String?
  resumeUrl        String?
  profileImage     String?
  latitude         Float?
  longitude        Float?
  location         String?
  preferredDomains Json?
  preferredRadius  Int?             @default(10)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  lastActive       DateTime?
  applications     JobApplication[]
  notifications    Notification[]

  @@index([email])
  @@index([phone])
  @@index([latitude, longitude])
  @@map("users")
}

model Company {
  id            String         @id @default(uuid())
  companyName   String
  workEmail     String         @unique
  password      String
  role          UserRole       @default("COMPANY")
  description   String?
  industry      String?
  website       String?
  logo          String?
  size          String?
  latitude      Float?
  longitude     Float?
  location      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  lastActive    DateTime?
  jobs          Job[]
  notifications Notification[]

  @@index([workEmail])
  @@index([latitude, longitude])
  @@map("companies")
}

model Job {
  id               String           @id @default(uuid())
  title            String
  description      String
  domain           String
  latitude         Float
  longitude        Float
  location         String
  employmentType   EmploymentType
  salaryRange      String?
  requirements     Json?
  benefits         Json?
  matchScore       Float?
  isActive         Boolean          @default(true)
  viewCount        Int              @default(0)
  applicationCount Int              @default(0)
  companyId        String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  expiresAt        DateTime?
  applications     JobApplication[]
  company          Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([domain])
  @@index([employmentType])
  @@index([latitude, longitude])
  @@index([isActive])
  @@index([createdAt])
  @@map("jobs")
}

model JobApplication {
  id             String            @id @default(uuid())
  jobId          String
  userId         String
  coverLetter    String?
  resumeUrl      String?
  status         ApplicationStatus @default("PENDING")
  matchScore     Int?
  notes          String?
  interviewDate  DateTime?
  interviewNotes String?
  appliedAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  job            Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId])
  @@index([jobId])
  @@index([userId])
  @@index([status])
  @@index([appliedAt])
  @@map("job_applications")
}

model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String
  isRead    Boolean  @default(false)
  userId    String?
  companyId String?
  metadata  Json?
  createdAt DateTime @default(now())
  company   Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([companyId, isRead])
  @@index([createdAt])
  @@map("notifications")
}

enum UserRole {
  JOB_SEEKER
  COMPANY
  ADMIN
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEW
  ACCEPTED
  REJECTED
  WITHDRAWN
}
